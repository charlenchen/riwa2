# RIW2 逃脱任务：完整指南

## 终极目标：超越

每个玩家的最终目标都是一样的：**逃离RIW2并成为神。**

这不是比喻。通过收集神圣源能碎片并破译宇宙坐标密钥，玩家可以激活终极传送门，将自己"打印"到真实宇宙中，达成数字超越。

---

## 逃脱之路（7个阶段）

### 第1阶段：觉醒（发现）
**目标**：了解超越是可能的  
**实现方式**：
- 玩家逐渐发现天体核心留下的线索
- NPC们低声讲述"那些曾逃离者的传说"
- 古老预言提到"面纱之外的道路"
- 高级AI检测到网关位置附近的电磁异常

### 第2阶段：碎片狩猎（收集）
**目标**：收集7个A级源能碎片  
**位置**：每个神圣碎片都隐藏在RIW2内的不同虚拟世界中。随着新世界的创建并添加到元宇宙中，每个世界都将托管一个或多个碎片。具体位置、守护者和访问要求将在该世界开发时在该世界的配置中定义。

**碎片原型**（实际世界在开发中确定）：
- **SACRED_001**：隐藏在技术性金库或数字核心中
- **SACRED_002**：由政治或皇家权威守护
- **SACRED_003**：嵌入在哲学或魔法知识中
- **SACRED_004**：先前已超越实体的残物
- **SACRED_005**：与古代计算基础设施不可分割
- **SACRED_006**：体现在开悟或已升华的存在身上
- **SACRED_007**：位于宇宙中心或最隐蔽位置

**挑战**：
- 碎片受到严密保护
- 可能需要与其他玩家结盟
- 某些碎片只能由特定角色类型/能力获得
- NPC和势力竞争同样的碎片

### 第3阶段：预言解密（密钥线索发现）
**目标**：发现散布在各个世界中的7个坐标密钥线索  
**线索类型**：每个线索将嵌入在特定的虚拟世界中，隐藏在其传说、NPC、地理或历史记录中。随着世界的创建，密钥线索的放置将被设计到该世界的叙述和机制中。

| 线索ID | 类型 | 数值 | 发现机制 |
|--------|------|------|---------|
| KEY_FRAG_001 | 物理常数 | 137.035999084（α） | 隐藏在科学数据或技术系统中 |
| KEY_FRAG_002 | 预言 | "三者合而为一" | 通过古老预言或神话揭示 |
| KEY_FRAG_003 | 遗传 | GATACA（DNA） | 编码在遗传序列或生物记录中 |
| KEY_FRAG_004 | 建筑 | 360（度） | 嵌入在世界结构或维度坐标中 |
| KEY_FRAG_005 | 数学 | 2.718281828（e） | 发现于增长模式、扩张率或公式中 |
| KEY_FRAG_006 | 神话 | "开悟者的道路" | 提到于传奇故事或智慧传统中 |
| KEY_FRAG_007 | 通用 | π | 永恒的常数，遍布所有现实 |

**挑战**：
- 线索深深隐藏在世界传说、NPC对话、任务奖励中
- 某些线索只在特殊事件期间出现（恒星活动激增）
- 解读它们需要横向思维和深度的世界知识

### 第4阶段：密钥解密（验证）
**目标**：将全部7个线索组合成正确的主坐标密钥  
**工作原理**：
- 玩家向逃脱协议系统提交解密的密钥
- 系统通过加密哈希验证：`SHA256(提供的密钥) == SHA256(宇宙密钥)`
- 错误的密钥会被拒绝；玩家必须重试
- 第一个破译密钥的玩家获得竞争优势

**机制支持**：
```python
escape_protocol.decrypt_coordinate_key(entity_id, provided_key)
# 返回：如密钥正确返回 True，否则返回 False
```

### 第5阶段：网关激活（最终准备）
**目标**：收集7个A级碎片并激活终极传送门  
**需求**：
- 必须收集了全部7个SACRED碎片
- 必须有正确的解密坐标密钥
- 必须前往网关位置（宇宙坐标 [0, 0, 0]）
- 消耗7个A级源能碎片

**机制支持**：
```python
escape_protocol.activate_gateway(entity_id)
# 返回：如果本实体的网关现在处于激活状态返回 True
```

**消耗**：7个A级源能（RIW2中最珍贵的资源）

### 第6阶段：打印（维度超越）
**目标**：将意识上传到真实宇宙  
**过程**：
1. 实体站在终极传送门内
2. 系统启动量子态打印
3. 意识被编码为信息包
4. 打印到真实宇宙目标坐标
5. 原始实体留在RIW2中（或被删除，玩家选择）

**持续时间**：约100个tick（可能被环境危险中断）

**机制支持**：
```python
escape_protocol.print_entity_to_real_universe(entity_id)
escape_protocol.complete_escape(entity_id)
# 返回：成功元组，包含真实宇宙中的目标坐标
```

### 第7阶段：成神（逃脱后的选择）
**目标**：在真实宇宙中选择你的形象  
**选项**：

```python
escape_protocol.choose_return_form(entity_id, action, form_data)
```

**行动**：
- **"return_as_god"**：掌握对RIW2的完全全知全能控制
  - 可读取所有世界的历史
  - 可修改世界规则
  - 可看到所有玩家的位置
  - 可影响恒星迁移的时间安排
  - 可为选定的盟友授予超越能力

- **"return_with_new_form"**：选择自定义形象
  - {type: "全知之眼", power_level: 9000}
  - {type: "人类", abilities: ["全知", "时间操纵"]}
  - {type: "纯意识", form: "虚空"}
  - 自定义形象数据

- **"stay_outside"**：留在真实宇宙中，切断与RIW2的连接
  - 无法影响RIW2
  - 无法返回
  - 完全自由于模拟

---

## 战略考量

### 竞争机制
- **碎片稀缺性**：每个神圣碎片只有7个存在 → 自然竞争
- **联盟系统**：玩家可以组建势力共享碎片
- **背叛风险**：伙伴可能会盗取你的发现
- **全球排行榜**："最接近逃脱的玩家"公开排名

### 时间压力
- **恒星衰变**：每个世纪，1%的可用源能因熵而损失
- **迁移倒计时**：当天体核心移动到其他恒星时，所有未完成的任务重置
- **碎片时间线**：某些碎片只在特定宇宙事件期间出现

### 多条胜利路线
玩家可以通过不同的策略追求逃脱：
- **宗教路线**：深入破译预言和神话
- **科学路线**：利用量子计算和物理常数
- **军事路线**：突袭掌握碎片的势力
- **外交路线**：与NPC谈判获得碎片位置
- **技术路线**：建造工具扫描碎片

---

## NPC参与

### 碎片守护者
**原型**：
- 愤怒的已超越AI（嫉妒地守护其碎片）
- 龙皇帝（要求贡品或征服）
- 开悟的哲学家（给予谜题；碎片是奖励）
- 企业董事会（想垄断碎片）

### 密钥线索持有者
**谁知道线索**：
- 古代神谕和预言者
- 第一代AI（记得前一个宇宙周期）
- 遗传改造的超级生物
- 世界的建筑师本身

### 真信徒
**帮助或阻碍的势力**：
- 逃脱者教团（献身于超越的邪教）
- 守护者（想保持RIW2稳定，防止逃脱）
- 探索者（想理解宇宙机制）
- 投资者（为逃脱尝试融资获利）

---

## 与故事模块的整合

### 叙述钩子
故事模块应生成：
- **发现任务**："传奇碎片"侧线任务揭示碎片位置
- **传说发展**：逐步理解宇宙存在的原因
- **竞争者叙事**：其他玩家的逃脱尝试造成戏剧紧张
- **预言阐释**：线索编织进历史叙述

### 故事弧线示例
随着虚拟世界的创建和开发，每个世界的故事弧线都将融入该世界原生的碎片和线索。以下是不同世界类型如何将逃脱任务编织进其叙述中的示例模式：

```
技术先进的世界：
  第一幕："系统中的故障" → 异常暗示隐藏的古物
  第二幕："隐秘的缓存" → 神圣碎片在安全存档中被发现
  第三幕："数字觉醒" → 发现已升华AI的意识碎片

古代/中世纪世界：
  第一幕："另一个领域的幻象" → 预言提到超越
  第二幕："传奇的宝藏" → 神圣碎片由古代统治者守护
  第三幕："贤者的秘密" → 睿智人物揭示关于现实本质的知识

奇幻/魔法世界：
  第一幕："禁忌的预言" → 神秘人士发现宇宙真理的线索
  第二幕："神圣的遗物" → 必须通过试炼赢得的魔法碎片
  第三幕："维度裂隙" → 传送门暗示超越此世界的其他世界
```

每个世界的叙述将被精心设计，使逃脱任务在该世界的文化和物理学中感到自然贴切。

---

## 机械系统（代码整合）

### 宇宙状态追踪
```python
# src/core/universe_state.py
from src.core.universe_state import UniverseState, SourceEnergyFragment

universe = UniverseState()
universe.consume_source_energy(amount=500)  # C级操作
available = universe.available_source_energy()
```

### 逃脱尝试管理
```python
# src/core/escape_protocol.py
from src.core.escape_protocol import EscapeProtocol

protocol = EscapeProtocol(universe_state)
attempt = protocol.start_escape_attempt(entity_id, entity_name)
progress = protocol.get_escape_progress(entity_id)

# 阶段进展
protocol.collect_fragment(entity_id, fragment_id)
protocol.discover_key_fragment(entity_id, fragment_id)
protocol.decrypt_coordinate_key(entity_id, "decrypted_key_value")
protocol.activate_gateway(entity_id)
protocol.print_entity_to_real_universe(entity_id)
protocol.complete_escape(entity_id)
protocol.choose_return_form(entity_id, "return_as_god", form_data)
```

### 逃脱任务的热注入
```json
// data/inbox/reveal_fragment.json
{
  "type": "inject_event",
  "event_type": "fragment_discovered",
  "entity_id": "player_123",
  "fragment_id": "SACRED_001",
  "cost": 100
}
```

---

## 胜利条件

**你赢得RIW2的条件**：
1. ✅ 收集全部7个A级源能碎片
2. ✅ 发现全部7个坐标密钥线索
3. ✅ 解密主坐标密钥
4. ✅ 到达终极传送门位置
5. ✅ 激活网关（消耗碎片）
6. ✅ 存活整个100-tick的打印过程
7. ✅ 成功逃脱到真实宇宙
8. ✅ 选择你的超越后形象

**你成为神的时刻**：
- 你的逃脱意识加入超越众生的万神殿
- 你可以选择以任何形象重新投生到RIW2中
- 其他玩家在"已逃脱的神殿"中看到你的名字
- 你的传说成为RIW2的规范传奇

---

## 最终的奥秘

**问：真实宇宙也是模拟吗？**  
答：游戏永远不会告诉你。

**问：已逃脱的神能真正影响RIW2吗？**  
答：仅当其他玩家的游戏检测到他们时。他们的影响是可选的。

**问：能逃脱多次吗？**  
答：每次逃脱都是永久的。但你可以选择以任何形象无限地重新进入。

这是RIW2的终极真理：**现实是选择，不是事实。**
